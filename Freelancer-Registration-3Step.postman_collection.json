{
	"info": {
		"_postman_id": "freelancer-registration-3step-2025",
		"name": "Freelancer Registration - 3 Step Flow",
		"description": "Complete 3-step registration flow for freelancers joining the FSM platform. Updated Dec 4, 2025.\n\nFlow:\n1. Enter Name & Phone ‚Üí Send OTP\n2. Verify OTP ‚Üí Get Temp Token\n3. Set Password ‚Üí Create Account & Login",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:4000",
			"type": "string"
		},
		{
			"key": "registrationPhone",
			"value": "01799999999",
			"type": "string"
		},
		{
			"key": "registrationName",
			"value": "Test Freelancer",
			"type": "string"
		},
		{
			"key": "registrationPassword",
			"value": "test123",
			"type": "string"
		},
		{
			"key": "otpCode",
			"value": "",
			"type": "string"
		},
		{
			"key": "tempToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "authToken",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "Step 1: Enter Name & Phone (Send OTP)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// Auto-save OTP code and temp token for Step 2",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    pm.collectionVariables.set('otpCode', jsonData.code);",
							"    pm.collectionVariables.set('tempToken', jsonData.tempToken);",
							"    console.log('‚úÖ Step 1 Complete');",
							"    console.log('OTP Code:', jsonData.code);",
							"    console.log('Temp Token:', jsonData.tempToken);",
							"    console.log('\\n‚û°Ô∏è  Proceed to Step 2: Verify OTP');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"phone\": \"{{registrationPhone}}\",\n  \"name\": \"{{registrationName}}\",\n  \"type\": \"REGISTRATION\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/otp/send",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"otp",
						"send"
					]
				},
				"description": "**STEP 1 OF 3: Enter Name & Phone Number**\n\nUser enters their full name and phone number to begin registration.\n\n**UI Screen: \"Join as Freelancer\"**\n- Full Name input field\n- Phone Number input field\n- \"Continue\" button\n- \"Already have an account? Login\" link\n\n**Request Body:**\n- `phone` (required): Phone number (10-15 digits)\n- `name` (required): Full name of the freelancer\n- `type` (required): Must be \"REGISTRATION\"\n\n**Success Response:**\n```json\n{\n  \"message\": \"OTP sent successfully\",\n  \"code\": \"123456\",\n  \"expiresAt\": \"2025-12-04T10:35:00.000Z\",\n  \"tempToken\": \"temp_1733305200000_abc123\",\n  \"tempTokenExpiry\": \"2025-12-04T10:40:00.000Z\",\n  \"smsStatus\": \"sent\"\n}\n```\n\n**What Happens:**\n1. OTP code is generated (6 digits)\n2. SMS is sent to the phone number\n3. OTP is valid for 5 minutes\n4. Temporary token is created (valid 10 minutes)\n5. User's name is stored temporarily for Step 3\n\n**Next Step:**\nProceed to Step 2 to verify the OTP code.\n\n**Testing:**\nThe OTP code and tempToken are automatically saved in collection variables for the next step.\n\n**UPDATED:** Dec 4, 2025 - Added name parameter for freelancer registration flow"
			}
		},
		{
			"name": "Step 2: Verify Phone (Verify OTP)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// Verify temp token matches",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    const savedToken = pm.collectionVariables.get('tempToken');",
							"    if (jsonData.tempToken === savedToken) {",
							"        console.log('‚úÖ Step 2 Complete');",
							"        console.log('Phone Verified:', jsonData.phone);",
							"        console.log('Temp Token Valid: ‚úì');",
							"        console.log('\\n‚û°Ô∏è  Proceed to Step 3: Set Password');",
							"    } else {",
							"        console.error('‚ö†Ô∏è  Warning: Temp token mismatch');",
							"    }",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"phone\": \"{{registrationPhone}}\",\n  \"code\": \"{{otpCode}}\",\n  \"type\": \"REGISTRATION\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/otp/verify",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"otp",
						"verify"
					]
				},
				"description": "**STEP 2 OF 3: Verify Phone Number**\n\nUser enters the 6-digit OTP code sent to their phone.\n\n**UI Screen: \"Verify Phone\"**\n- Display: \"OTP sent to your phone\" with phone number\n- OTP Code input (6-digit numeric)\n- \"Resend OTP\" button (calls Step 1 again)\n- \"Verify & Continue\" button\n- \"Back\" button\n\n**Request Body:**\n- `phone` (required): Same phone number from Step 1\n- `code` (required): 6-digit OTP code\n- `type` (required): Must be \"REGISTRATION\"\n\n**Success Response:**\n```json\n{\n  \"message\": \"OTP verified successfully. You can now set your password.\",\n  \"verified\": true,\n  \"phone\": \"01799999999\",\n  \"tempToken\": \"temp_1733305200000_abc123\",\n  \"tempTokenExpiry\": \"2025-12-04T10:40:00.000Z\"\n}\n```\n\n**What Happens:**\n1. OTP code is validated against database\n2. OTP is marked as used (one-time use)\n3. Same temp token is returned for Step 3\n4. Phone number is verified\n\n**Error Responses:**\n- `Invalid or expired OTP` (400) - Wrong code or expired\n- `Invalid OTP format` (400) - Not 6 digits\n\n**Next Step:**\nProceed to Step 3 to set password and complete registration.\n\n**Testing:**\nThe OTP code is automatically filled from Step 1 response.\n\n**UPDATED:** Dec 4, 2025 - Part of 3-step freelancer registration flow"
			}
		},
		{
			"name": "Step 3: Set Password (Create Account)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// Save auth token for future requests",
							"if (pm.response.code === 201) {",
							"    const jsonData = pm.response.json();",
							"    pm.collectionVariables.set('authToken', jsonData.token);",
							"    console.log('‚úÖ Step 3 Complete');",
							"    console.log('üéâ Registration Successful!');",
							"    console.log('User ID:', jsonData.user.id);",
							"    console.log('Name:', jsonData.user.name);",
							"    console.log('Phone:', jsonData.user.phone);",
							"    console.log('Role:', jsonData.user.role);",
							"    console.log('Auth Token:', jsonData.token.substring(0, 50) + '...');",
							"    console.log('\\n‚úÖ You are now logged in and can access protected endpoints');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"phone\": \"{{registrationPhone}}\",\n  \"password\": \"{{registrationPassword}}\",\n  \"tempToken\": \"{{tempToken}}\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/auth/set-password",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"auth",
						"set-password"
					]
				},
				"description": "**STEP 3 OF 3: Set Password & Create Account**\n\nUser creates a secure password to complete registration.\n\n**UI Screen: \"Set Password\"**\n- Password input field (with show/hide toggle)\n- Password strength indicator (optional)\n- Validation: \"Password must be at least 6 characters long\"\n- \"Create Account\" button\n- \"Back\" button\n\n**Request Body:**\n- `phone` (required): Same phone number from Steps 1 & 2\n- `password` (required): Password (minimum 6 characters)\n- `tempToken` (required): Temp token from Step 2 verification\n\n**Success Response:**\n```json\n{\n  \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"user\": {\n    \"id\": 123,\n    \"name\": \"Test Freelancer\",\n    \"phone\": \"01799999999\",\n    \"email\": null,\n    \"role\": \"TECH_FREELANCER\"\n  },\n  \"message\": \"Account created successfully! Welcome to FSM.\"\n}\n```\n\n**What Happens:**\n1. Password is validated (minimum 6 characters)\n2. Temporary token is verified\n3. Name from Step 1 is retrieved from OTP record\n4. User account is created:\n   - Role: TECH_FREELANCER (default)\n   - Password: Bcrypt hashed\n5. Technician profile is created:\n   - Type: FREELANCER\n   - Commission Rate: 40%\n   - Status: ACTIVE\n6. Wallet is initialized (balance: 0)\n7. JWT token is generated (valid 7 days)\n8. User is automatically logged in\n\n**Error Responses:**\n- `Invalid or expired temporary token` (400) - Token expired or invalid\n- `Password must be at least 6 characters long` (400) - Weak password\n- `Phone already registered` (400) - Phone exists with password\n\n**After Registration:**\nUser is logged in with the returned JWT token and can:\n- View their profile: GET /api/auth/profile\n- Update profile: PATCH /api/auth/profile\n- Accept work orders\n- View dashboard stats\n\n**Testing:**\nThe auth token is automatically saved in collection variables.\nYou can now use \"Get Profile\" request to verify account creation.\n\n**UPDATED:** Dec 4, 2025 - Completes 3-step freelancer registration flow with automatic technician profile creation"
			}
		},
		{
			"name": "Get Profile (Verify Registration)",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{authToken}}"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/auth/profile",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"auth",
						"profile"
					]
				},
				"description": "**Verify Registration Completion**\n\nUse this endpoint after Step 3 to verify that:\n1. User account was created successfully\n2. Technician profile exists\n3. Role is TECH_FREELANCER\n4. All profile fields are set correctly\n\n**Requires:** Authentication (Bearer token from Step 3)\n\n**Expected Response:**\n```json\n{\n  \"id\": 123,\n  \"name\": \"Test Freelancer\",\n  \"phone\": \"01799999999\",\n  \"role\": \"TECH_FREELANCER\",\n  \"technicianProfile\": {\n    \"id\": 45,\n    \"type\": \"FREELANCER\",\n    \"commissionRate\": 0.4,\n    \"bonusRate\": 0.05,\n    \"status\": \"ACTIVE\",\n    \"skills\": [],\n    \"certifications\": [],\n    \"responseTime\": { \"minutes\": 0, \"status\": \"excellent\" },\n    \"bonus\": { \"thisWeek\": 0, \"rate\": 0.4, \"type\": \"Commission\" },\n    \"priorityStatus\": { \"counts\": {...}, \"percentages\": {...} }\n  }\n}\n```\n\n**Profile Sections:**\n\n**14.1 Employment Details:**\n- department\n- joinDate\n- position\n\n**14.2 Skills & Specializations:**\n- skills (array)\n- specialization (string)\n\n**14.3 My Certifications:**\n- certifications (array of {name, url, verifiedAt})\n\n**15.1 Response Time:**\n- responseTime.minutes\n- responseTime.formatted (\"15 min\" or \"1h 30m\")\n- responseTime.status (excellent/good/average)\n\n**15.2 Bonus Information:**\n- bonus.thisWeek (current week earnings)\n- bonus.rate (0.4 = 40%)\n- bonus.ratePercentage (40)\n- bonus.type (\"Commission\" for freelancers)\n\n**15.3 Priority Status:**\n- priorityStatus.counts (LOW/MEDIUM/HIGH job counts)\n- priorityStatus.percentages\n- priorityStatus.mostCommon\n\n**Next Steps:**\nFreelancer can now:\n- Update profile with skills and certifications\n- Accept work orders\n- View dashboard stats\n- Track earnings"
			}
		},
		{
			"name": "Resend OTP (If Needed)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// Update OTP code and temp token",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    pm.collectionVariables.set('otpCode', jsonData.code);",
							"    pm.collectionVariables.set('tempToken', jsonData.tempToken);",
							"    console.log('‚úÖ OTP Resent Successfully');",
							"    console.log('New OTP Code:', jsonData.code);",
							"    console.log('New Temp Token:', jsonData.tempToken);",
							"    console.log('\\n‚û°Ô∏è  Return to Step 2: Verify OTP');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"phone\": \"{{registrationPhone}}\",\n  \"name\": \"{{registrationName}}\",\n  \"type\": \"REGISTRATION\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/otp/send",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"otp",
						"send"
					]
				},
				"description": "**Resend OTP (Step 2 Helper)**\n\nIf user doesn't receive OTP or it expires, they can request a new one.\n\n**When to Use:**\n- OTP expired (after 5 minutes)\n- User didn't receive SMS\n- User entered wrong code too many times\n\n**UI Implementation:**\n\"Resend OTP\" button on Step 2 screen\n\n**What Happens:**\n1. New OTP code is generated\n2. New SMS is sent\n3. Previous OTP codes become invalid\n4. New temp token is created\n5. User must use the new OTP code\n\n**Rate Limiting (Recommended):**\n- Allow resend after 30 seconds\n- Show countdown timer\n- Limit to 3 resends per phone per hour\n\n**Testing:**\nNew OTP code and temp token are automatically saved.\n\n**Note:** This is the same endpoint as Step 1, but called again with same data."
			}
		},
		{
			"name": "Login After Registration",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// Save auth token",
							"if (pm.response.code === 200) {",
							"    const jsonData = pm.response.json();",
							"    pm.collectionVariables.set('authToken', jsonData.token);",
							"    console.log('‚úÖ Login Successful');",
							"    console.log('User:', jsonData.user.name);",
							"    console.log('Role:', jsonData.user.role);",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"phone\": \"{{registrationPhone}}\",\n  \"password\": \"{{registrationPassword}}\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/auth/login",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"auth",
						"login"
					]
				},
				"description": "**Login with Created Account**\n\nAfter completing registration, users can login with phone + password.\n\n**Request Body:**\n- `phone` (required): Registered phone number\n- `password` (required): Password set in Step 3\n\n**Success Response:**\n```json\n{\n  \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"user\": {\n    \"id\": 123,\n    \"name\": \"Test Freelancer\",\n    \"phone\": \"01799999999\",\n    \"email\": null,\n    \"role\": \"TECH_FREELANCER\",\n    \"isBlocked\": false,\n    \"createdAt\": \"2025-12-04T10:30:00.000Z\"\n  }\n}\n```\n\n**Error Responses:**\n- `User not found` (404) - Phone not registered\n- `Invalid password` (401) - Wrong password\n- `Your account has been blocked` (403) - Account suspended\n\n**UI Flow:**\n\"Already have an account? Login\" link on Step 1 screen\n\n**Testing:**\nUse credentials from registration:\n- Phone: {{registrationPhone}}\n- Password: {{registrationPassword}}"
			}
		}
	]
}
