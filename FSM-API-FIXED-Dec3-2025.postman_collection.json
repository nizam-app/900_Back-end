{
	"info": {
		"name": "FSM API - Fixed Endpoints (Dec 3, 2025)",
		"description": "Collection containing all endpoints fixed/updated on December 3, 2025 - Technician Profile Enhancements",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. Technician Profile - Employment Details",
			"item": [
				{
					"name": "Get Profile with Employment",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{techToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/auth/profile",
							"host": ["{{baseUrl}}"],
							"path": ["api", "auth", "profile"]
						},
						"description": "✅ ENHANCED - Technician Profile with Employment Details\n\n**NEW FIELDS ADDED (Dec 3, 2025):**\n\n**14.1 Employment Details:**\n```json\n{\n  \"department\": \"Field Services\",\n  \"joinDate\": \"2023-01-15T00:00:00.000Z\",\n  \"position\": \"Senior Technician\",\n  \"status\": \"ACTIVE\"\n}\n```\n\n**14.2 Skills & Specializations:**\n```json\n{\n  \"skills\": [\"Electrical\", \"Plumbing\", \"HVAC\"]\n}\n```\n\n**14.3 Certifications:**\n```json\n{\n  \"certifications\": [\n    {\n      \"name\": \"Electrical Engineering Diploma\",\n      \"url\": \"/uploads/cert-1.pdf\",\n      \"verifiedAt\": \"2025-12-03T09:24:10.212Z\"\n    }\n  ]\n}\n```\n\n**15.1 Response Time:**\n```json\n{\n  \"responseTime\": {\n    \"minutes\": 25,\n    \"formatted\": \"25 min\",\n    \"status\": \"excellent\"\n  }\n}\n```\n\n**15.2 Bonus Information:**\n```json\n{\n  \"bonus\": {\n    \"thisWeek\": 5400,\n    \"rate\": 0.4,\n    \"ratePercentage\": 40,\n    \"type\": \"Commission\"\n  }\n}\n```\n\n**15.3 Priority Status:**\n```json\n{\n  \"priorityStatus\": {\n    \"counts\": {\"high\": 6, \"medium\": 6, \"low\": 0},\n    \"percentages\": {\"high\": 50, \"medium\": 50, \"low\": 0},\n    \"mostCommon\": \"HIGH\"\n  }\n}\n```\n\n**COMPLETE RESPONSE STRUCTURE:**\n```json\n{\n  \"id\": 5,\n  \"name\": \"Mike Freelancer\",\n  \"phone\": \"5555555555\",\n  \"email\": \"tech.freelancer@fsm.com\",\n  \"role\": \"TECH_FREELANCER\",\n  \"technicianProfile\": {\n    \"id\": 2,\n    \"type\": \"FREELANCER\",\n    \"commissionRate\": 0.4,\n    \"bonusRate\": 0.05,\n    \"status\": \"ACTIVE\",\n    \"department\": \"Field Services\",\n    \"joinDate\": \"2023-01-15T00:00:00.000Z\",\n    \"position\": \"Senior Technician\",\n    \"skills\": [\"Electrical\", \"Plumbing\"],\n    \"certifications\": [\n      {\n        \"name\": \"Electrical Engineering Diploma\",\n        \"url\": \"/uploads/cert-1.pdf\",\n        \"verifiedAt\": \"2025-12-03T09:24:10.212Z\"\n      },\n      {\n        \"name\": \"Plumbing License\",\n        \"url\": \"/uploads/cert-2.pdf\",\n        \"verifiedAt\": \"2025-12-03T09:24:10.212Z\"\n      }\n    ],\n    \"responseTime\": {\n      \"minutes\": 25,\n      \"formatted\": \"25 min\",\n      \"status\": \"excellent\"\n    },\n    \"bonus\": {\n      \"thisWeek\": 5400,\n      \"rate\": 0.4,\n      \"ratePercentage\": 40,\n      \"type\": \"Commission\"\n    },\n    \"priorityStatus\": {\n      \"counts\": {\"high\": 6, \"medium\": 6, \"low\": 0},\n      \"percentages\": {\"high\": 50, \"medium\": 50, \"low\": 0},\n      \"mostCommon\": \"HIGH\"\n    }\n  }\n}\n```\n\n**Authorization:** Technician only (TECH_FREELANCER, TECH_INTERNAL)\n\n**UI Mapping:**\n- 14.1: Employment Details section\n- 14.2: Skills badges\n- 14.3: Certifications list with count\n- 15.1: Response time card with rating\n- 15.2: Weekly bonus display\n- 15.3: Priority job distribution chart\n\n**Status:** ✅ PRODUCTION READY"
					}
				}
			]
		},
		{
			"name": "2. Technician Dashboard",
			"item": [
				{
					"name": "Get Dashboard Stats",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{techToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/technician/dashboard",
							"host": ["{{baseUrl}}"],
							"path": ["api", "technician", "dashboard"]
						},
						"description": "✅ COMPLETE - Technician Dashboard Statistics\n\n**Response Structure:**\n```json\n{\n  \"thisWeekBonus\": 1800,\n  \"jobsToday\": 2,\n  \"activeJobs\": 1,\n  \"completedThisMonth\": 28,\n  \"inProgress\": 1,\n  \"readyToStart\": 2\n}\n```\n\n**Field Descriptions:**\n- `thisWeekBonus`: Total bonus/commission earned this week\n- `jobsToday`: Number of jobs scheduled for today\n- `activeJobs`: Jobs currently in progress or accepted\n- `completedThisMonth`: Total jobs completed this month\n- `inProgress`: Jobs with IN_PROGRESS status\n- `readyToStart`: Jobs with ASSIGNED status\n\n**Authorization:** Technician only\n\n**Status:** ✅ TESTED & WORKING"
					}
				}
			]
		},
		{
			"name": "3. Technician Jobs",
			"item": [
				{
					"name": "Get Jobs by Status",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{techToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/technician/jobs?status=incoming",
							"host": ["{{baseUrl}}"],
							"path": ["api", "technician", "jobs"],
							"query": [
								{
									"key": "status",
									"value": "incoming",
									"description": "incoming | active | done"
								}
							]
						},
						"description": "✅ NEW ENDPOINT - Get technician jobs filtered by status\n\n**Query Parameter: status**\n- `incoming`: ASSIGNED jobs (ready to accept)\n- `active`: ACCEPTED or IN_PROGRESS jobs\n- `done`: COMPLETED or PAID_VERIFIED jobs\n\n**Response Structure:**\n```json\n[\n  {\n    \"id\": 2,\n    \"woNumber\": \"WO-1234567891\",\n    \"status\": \"IN_PROGRESS\",\n    \"priority\": \"HIGH\",\n    \"scheduledAt\": \"2025-12-03T00:00:00.000Z\",\n    \"customer\": {\n      \"name\": \"Jane Smith\",\n      \"phone\": \"8888888888\"\n    },\n    \"service\": {\n      \"name\": \"HVAC Repair\"\n    },\n    \"category\": {\n      \"name\": \"HVAC\"\n    },\n    \"address\": \"789 Smith Road, Nairobi\",\n    \"estimatedDuration\": 60,\n    \"bonusCalculation\": {\n      \"baseRate\": 900,\n      \"rate\": 0.4,\n      \"bonus\": 360,\n      \"rateDisplay\": \"40% Commission\"\n    }\n  }\n]\n```\n\n**Features:**\n- Shows calculated bonus for each job\n- Includes customer and service details\n- Filtered by technician's assignments\n- Sorted by scheduled date\n\n**Authorization:** Technician only\n\n**Status:** ✅ TESTED & WORKING"
					}
				}
			]
		},
		{
			"name": "4. Technician Earnings",
			"item": [
				{
					"name": "Get Earnings Summary",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{techToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/technician/earnings",
							"host": ["{{baseUrl}}"],
							"path": ["api", "technician", "earnings"]
						},
						"description": "✅ ENHANCED - Complete Earnings Summary\n\n**Response Structure:**\n```json\n{\n  \"totalBonuses\": {\n    \"amount\": 12500,\n    \"increaseRate\": 25.5,\n    \"increaseText\": \"+25.5% from last month\"\n  },\n  \"breakdown\": {\n    \"today\": 1800,\n    \"thisWeek\": 5400,\n    \"thisWeekPercentage\": 40,\n    \"thisMonth\": 12500\n  },\n  \"availableBonus\": {\n    \"amount\": 5400,\n    \"jobsCount\": 6,\n    \"jobsText\": \"6 jobs\",\n    \"bonusText\": \"40% bonus\",\n    \"payoutInfo\": \"Regular payout: Every Monday\"\n  },\n  \"bonusRate\": {\n    \"rate\": 0.4,\n    \"ratePercentage\": 40,\n    \"type\": \"Commission\",\n    \"description\": \"Earn 40% commission on every verified job completion...\"\n  },\n  \"monthlySalary\": {\n    \"baseSalary\": 0,\n    \"thisMonthBonus\": 12500,\n    \"total\": 12500,\n    \"isFreelancer\": true\n  },\n  \"recentBonuses\": [\n    {\n      \"id\": 1,\n      \"jobName\": \"HVAC Repair\",\n      \"customerName\": \"Michael Johnson\",\n      \"date\": \"2025-12-03T14:00:00Z\",\n      \"jobPayment\": 900,\n      \"bonus\": 360,\n      \"status\": \"BOOKED\",\n      \"woNumber\": \"WO-123\"\n    }\n  ]\n}\n```\n\n**Field Descriptions:**\n\n**totalBonuses:**\n- All-time earnings with month-over-month growth rate\n\n**breakdown:**\n- Today, this week, this month earnings\n- Current bonus/commission percentage\n\n**availableBonus:**\n- This week's earnings available for payout\n- Number of jobs contributing to bonus\n- Payout schedule information\n\n**bonusRate:**\n- Current commission/bonus rate\n- Type (Commission for freelancers, Bonus for internal)\n- Detailed description\n\n**monthlySalary:**\n- Base salary (internal staff only)\n- This month's bonus earnings\n- Total monthly earnings\n\n**recentBonuses:**\n- Last 10 bonus transactions\n- Job details, customer, payment amounts\n\n**Authorization:** Technician only\n\n**Status:** ✅ TESTED & WORKING"
					}
				}
			]
		},
		{
			"name": "5. Work Order Complete",
			"item": [
				{
					"name": "Complete Work Order",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{techToken}}"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "completionNotes",
									"value": "Job completed successfully. All electrical outlets tested.",
									"type": "text"
								},
								{
									"key": "materialsUsed",
									"value": "[{\"item\":\"Wire\",\"qty\":10,\"cost\":50}]",
									"type": "text"
								},
								{
									"key": "photos",
									"type": "file",
									"src": []
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/wos/{{woId}}/complete",
							"host": ["{{baseUrl}}"],
							"path": ["api", "wos", "{{woId}}", "complete"]
						},
						"description": "✅ FIXED - Complete job from ACCEPTED status\n\n**WHAT WAS FIXED:**\n- Now accepts jobs in ACCEPTED status (not just IN_PROGRESS)\n- Photos are now OPTIONAL (not required)\n- Returns bonus calculation in response\n\n**Request Body:**\n- completionNotes (optional): Work description\n- materialsUsed (optional): JSON array of materials\n- photos (optional): File uploads (0-5 files)\n\n**Response Structure:**\n```json\n{\n  \"message\": \"Work order completed\",\n  \"workOrder\": {\n    \"id\": 2,\n    \"woNumber\": \"WO-123\",\n    \"status\": \"COMPLETED\",\n    \"completedAt\": \"2025-12-03T14:30:00Z\"\n  },\n  \"bonusCalculation\": {\n    \"baseRate\": 900,\n    \"rate\": 0.4,\n    \"bonus\": 360,\n    \"rateDisplay\": \"40% Commission\"\n  }\n}\n```\n\n**Bonus Calculation:**\n- Freelancers: baseRate × commissionRate (40%)\n- Internal: baseRate × bonusRate (5%)\n- Calculated from service.baseRate\n\n**Status Flow:**\n- ACCEPTED → COMPLETED (✅ Now allowed)\n- IN_PROGRESS → COMPLETED (✅ Still works)\n\n**Authorization:** Technician only (must be assigned to the WO)\n\n**Status:** ✅ FIXED & TESTED"
					}
				}
			]
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:4000",
			"type": "string"
		},
		{
			"key": "techToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "woId",
			"value": "",
			"type": "string"
		}
	]
}
