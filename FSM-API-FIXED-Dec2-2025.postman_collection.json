{
	"info": {
		"name": "FSM API - Fixed Endpoints (Dec 2, 2025)",
		"description": "Collection containing only the endpoints fixed/updated on December 2, 2025",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. OTP System - FIXED",
			"item": [
				{
					"name": "Send OTP",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"phone\": \"+8801718981009\",\n  \"type\": \"REGISTRATION\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/otp/send",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"otp",
								"send"
							]
						},
						"description": "✅ FIXED - Send OTP with correct Bangladesh phone format\n\n**What was fixed:**\n- Changed country code from 88 to 880\n- Added + prefix for BulkGate API\n- SMS delivery now working\n\n**Phone Formats Supported:**\n- +8801718981009 (recommended)\n- 8801718981009 (auto-formatted)\n- 01718981009 (auto-converted)\n\n**Testing Status:** ✅ VERIFIED WORKING\n\n**Response includes:**\n- OTP code (for testing)\n- Expiry time (5 minutes)\n- SMS status (sent/failed)"
					}
				},
				{
					"name": "Verify OTP",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"phone\": \"+8801718981009\",\n  \"code\": \"123456\",\n  \"type\": \"REGISTRATION\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/otp/verify",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"otp",
								"verify"
							]
						},
						"description": "✅ FIXED - Verify OTP with correct phone format matching\n\n**What was fixed:**\n- Phone format matching updated\n- Handles multiple phone formats\n- Verification now successful\n\n**Testing Status:** ✅ VERIFIED WORKING\n\n**Success Response:**\n- verified: true\n- tempToken: For registration\n- tempTokenExpiry: Token expiration"
					}
				}
			]
		},
		{
			"name": "2. Work Order Reschedule - NEW",
			"item": [
				{
					"name": "Reschedule WO",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{dispatcherToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"scheduledDate\": \"2025-12-05\",\n  \"scheduledTime\": \"14:00\",\n  \"estimatedDuration\": 2,\n  \"notes\": \"Rescheduled at customer request\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/wos/{{woId}}/reschedule",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"wos",
								"{{woId}}",
								"reschedule"
							]
						},
						"description": "⭐ NEW ENDPOINT - Reschedule work order to different date and time\n\n**Created:** December 2, 2025\n\n**Authorization:** Admin/Dispatcher only\n\n**Use Cases:**\n• Customer requests different date/time\n• Technician availability changed\n• Weather or emergency delays\n• Optimizing technician schedule\n\n**Request Body:**\n• scheduledDate (required): Date in YYYY-MM-DD format\n• scheduledTime (required): Time in HH:MM format (24-hour)\n• estimatedDuration (optional): Duration in hours (auto-converted to minutes)\n• notes (optional): Reason for rescheduling\n\n**Features:**\n• Validates date is in the future\n• Cannot reschedule COMPLETED or CANCELLED WOs\n• Creates audit log entry\n• Updates work order status\n\n**Status:** ✅ PRODUCTION READY"
					}
				}
			]
		},
		{
			"name": "3. Work Order Assignment - FIXED",
			"item": [
				{
					"name": "Reassign WO",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{dispatcherToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"technicianId\": 5,\n  \"reason\": \"Previous technician unavailable\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/wos/{{woId}}/reassign",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"wos",
								"{{woId}}",
								"reassign"
							]
						},
						"description": "✅ FIXED - Reassign work order to different technician\n\n**What was fixed:**\n- Changed technicianId from 6 (blocked) to 5 (active freelancer)\n- Added warning about using active technicians\n- Enhanced documentation\n\n**Authorization:** Admin/Dispatcher only\n\n**Available Technician IDs:**\n• ID 4: John Technician (TECH_INTERNAL) - Phone: 4444444444\n• ID 5: Mike Freelancer (TECH_FREELANCER) - Phone: 5555555555\n\n**Use Cases:**\n• Original technician unavailable\n• Better skilled technician needed\n• Load balancing between technicians\n• Technician declined the job\n\n**Request Body:**\n• technicianId (required): New technician ID (must be active technician role)\n• reason (optional): Reason for reassignment\n\n**IMPORTANT:** Ensure the technician ID belongs to a user with TECH_INTERNAL or TECH_FREELANCER role. Regular users cannot be assigned work orders.\n\n**Status:** ✅ FIXED & TESTED"
					}
				}
			]
		},
		{
			"name": "4. Technician Dashboard - ENHANCED",
			"item": [
				{
					"name": "Technician Dashboard",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{techToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/commissions/dashboard",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"commissions",
								"dashboard"
							]
						},
						"description": "✅ ENHANCED - Technician Financial Dashboard\n\n**UI: This Month Breakdown Section**\n\nDisplays monthly performance summary:\n```\nJobs Completed\n28 jobs                    $6,450\n\nCommission\nEarnings rate              $320\n\nTotal                      $6,770\n```\n\n**API Response:**\n```json\n{\n  \"walletBalance\": 6770,\n  \"totalEarned\": 320,\n  \"totalPaid\": 0,\n  \"pendingPayout\": 320,\n  \"totalAllTimeEarnings\": 320,\n  \"totalJobsCompleted\": 28\n}\n```\n\n**Field Mapping:**\n• **Jobs Completed:** totalJobsCompleted (28 jobs)\n• **Jobs Value:** Sum payments from completed WOs ($6,450)\n• **Commission:** totalEarned ($320 at 15% rate)\n• **Total:** walletBalance ($6,770)\n\n**Status:** ✅ PRODUCTION READY"
					}
				},
				{
					"name": "Get My Wallet Balance",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{techToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/commissions/wallet",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"commissions",
								"wallet"
							]
						},
						"description": "✅ ENHANCED - Complete documentation added\n\n**Response includes:**\n• balance: Current available balance (always >= 0)\n• actualBalance: Real balance (may be negative)\n• recentTransactions: Last 10 transactions\n• warning: Alert if balance adjustment needed\n\n**Status:** ✅ DOCUMENTED"
					}
				},
				{
					"name": "Get My Commissions",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{techToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/commissions/my-commissions?status=EARNED",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"commissions",
								"my-commissions"
							],
							"query": [
								{
									"key": "status",
									"value": "EARNED"
								},
								{
									"key": "startDate",
									"value": "2025-11-01",
									"disabled": true
								},
								{
									"key": "endDate",
									"value": "2025-11-30",
									"disabled": true
								}
							]
						},
						"description": "✅ ENHANCED - Commission Transaction History\n\n**UI: Recent Transactions**\n\n```\nRecent Transactions        View All\n\nHVAC Maintenance           $95\nMichael Johnson\nToday, 2:00 PM\n\nPlumbing Repair            $75\nRobert Brown\nNov 3, 2025\n```\n\n**API Response:**\n```json\n[\n  {\n    \"amount\": 95,\n    \"status\": \"EARNED\",\n    \"workOrder\": {\n      \"woNumber\": \"WO-123\",\n      \"completedAt\": \"2025-12-03T14:00:00Z\",\n      \"customer\": { \"name\": \"Michael Johnson\" },\n      \"category\": { \"name\": \"HVAC Maintenance\" }\n    },\n    \"createdAt\": \"2025-12-03T14:00:00Z\"\n  }\n]\n```\n\n**Query Parameters:**\n• status: EARNED, PAID, PENDING\n• startDate: YYYY-MM-DD\n• endDate: YYYY-MM-DD\n• limit: 4 (for recent list)\n\n**Display:**\n1. Job Type: category.name\n2. Customer: customer.name\n3. Date: Format completedAt\n4. Amount: Commission earned\n\n**Status:** ✅ PRODUCTION READY"
					}
				}
			]
		},
		{
			"name": "5. Freelancer Work Orders - ENHANCED",
			"item": [
				{
					"name": "Get All Work Orders",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{techToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/wos?status=ASSIGNED",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"wos"
							],
							"query": [
								{
									"key": "status",
									"value": "ASSIGNED",
									"description": "Filter by work order status"
								},
								{
									"key": "technicianId",
									"value": "",
									"disabled": true,
									"description": "Filter by technician ID (for my tasks)"
								},
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "limit",
									"value": "10",
									"disabled": true
								}
							]
						},
						"description": "✅ ENHANCED - Complete filtering guide for freelancer dashboard\n\n**2.1 WHERE I GET START, ACTIVE, THIS MONTH:**\n\nThese counts come from filtering work orders by status and counting results:\n\n• **Ready to Start (2)**: Work orders with status=ASSIGNED\n  - API: `GET /api/wos?technicianId={yourId}&status=ASSIGNED`\n  - Meaning: Jobs assigned to you, waiting for acceptance\n  - UI: Shows in \"Ready to Start\" section\n\n• **Active Now (1)**: Work orders with status=ACCEPTED or IN_PROGRESS\n  - API: `GET /api/wos?technicianId={yourId}&status=ACCEPTED`\n  - API: `GET /api/wos?technicianId={yourId}&status=IN_PROGRESS`\n  - Meaning: Jobs you accepted or currently working on\n  - UI: Shows in \"Active\" tab\n\n• **This Month (28)**: Work orders with status=COMPLETED\n  - API: `GET /api/wos?technicianId={yourId}&status=COMPLETED`\n  - Meaning: Jobs you finished this month\n  - UI: Shows in \"Completed\" tab\n  - Also available in: `/api/commissions/dashboard` → totalJobsCompleted\n\n**2.2 TASKS ASSIGNED TO FREELANCER TECHNICIAN:**\n\nEach task card shows:\n• Customer: Name + Phone (from workOrder.customer)\n• Location: Address with GPS (from workOrder.address, latitude, longitude)\n• Scheduled: Date and time (from workOrder.scheduledAt)\n• Commission: Your earnings (from workOrder.commissions)\n• Payment note: \"Payment follows completion verification\"\n\n**Query Parameters:**\n• status: Filter by status (UNASSIGNED, ASSIGNED, ACCEPTED, IN_PROGRESS, COMPLETED, CANCELLED)\n• technicianId: YOUR USER ID - Filter to see only your tasks\n• customerId: Filter by customer ID\n• priority: Filter by priority (LOW, MEDIUM, HIGH, URGENT)\n• page: Page number (default: 1)\n• limit: Results per page (default: 10)\n\n**Example API Calls:**\n```\n// Get your ready to start tasks (2)\nGET /api/wos?technicianId=5&status=ASSIGNED\n\n// Get your active tasks (1)\nGET /api/wos?technicianId=5&status=ACCEPTED\nGET /api/wos?technicianId=5&status=IN_PROGRESS\n\n// Get your completed tasks this month (28)\nGET /api/wos?technicianId=5&status=COMPLETED\n```\n\n**Response includes:**\n• Full work order details with customer info (name, phone)\n• Technician assignment\n• Category and service details\n• Payment amount and commission data\n• Service request reference\n• GPS coordinates for location\n• Scheduled date and time\n\n**Status Flow:**\nASSIGNED → ACCEPTED → IN_PROGRESS → COMPLETED\n\n**Status:** ✅ PRODUCTION READY"
					}
				},
				{
					"name": "Accept WO (Technician)",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{techToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"action\": \"ACCEPT\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/wos/{{woId}}/respond",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"wos",
								"{{woId}}",
								"respond"
							]
						},
						"description": "✅ ENHANCED - Complete action flow documented\n\n**Action:** ACCEPT\n\nTechnician accepts assigned work order (Ready to Start).\n\nThis moves the work order from ASSIGNED to ACCEPTED status, indicating the technician has confirmed they will complete the job.\n\n**Next Steps:**\n1. Technician reviews job details\n2. Travels to customer location\n3. Clicks Start Job button with GPS check-in\n\n**UI Button:** View Details → Accept Job\n\n**Status:** ✅ DOCUMENTED"
					}
				},
				{
					"name": "Decline WO (Technician)",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{techToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"action\": \"DECLINE\",\n  \"declineReason\": \"Unable to reach location\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/wos/{{woId}}/respond",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"wos",
								"{{woId}}",
								"respond"
							]
						},
						"description": "✅ ENHANCED - Decline reasons documented\n\n**Action:** DECLINE\n**Required:** declineReason (string)\n\nTechnician declines assigned work order. This returns the work order to UNASSIGNED status so dispatcher can reassign to another technician.\n\n**Common decline reasons:**\n• Unable to reach location\n• Lack required skills or tools\n• Schedule conflict\n• Emergency situation\n\n**Status:** ✅ DOCUMENTED"
					}
				},
				{
					"name": "Start Job (GPS Check-in)",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{techToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"lat\": 23.8103,\n  \"lng\": 90.4125\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/wos/{{woId}}/start",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"wos",
								"{{woId}}",
								"start"
							]
						},
						"description": "✅ ENHANCED - GPS check-in flow documented\n\n**Required:**\n• lat: Latitude coordinate\n• lng: Longitude coordinate\n\nStart work order with GPS check-in verification. This changes status from ACCEPTED to IN_PROGRESS and records start time, GPS coordinates for location verification, and technician arrival confirmation.\n\n**UI Flow:**\n1. Technician clicks Continue or Start Job button\n2. App captures GPS location\n3. Verifies technician is at job site\n4. Status updates to In Progress\n\n**Note:** GPS verification ensures service quality and prevents fraud.\n\n**Status:** ✅ DOCUMENTED"
					}
				},
				{
					"name": "Complete Job",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{techToken}}"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "completionNotes",
									"value": "Regular maintenance check for air conditioning unit",
									"type": "text"
								},
								{
									"key": "materialsUsed",
									"value": "[{\"item\":\"Air Filter\",\"qty\":1,\"cost\":50}]",
									"type": "text"
								},
								{
									"key": "photos",
									"type": "file",
									"src": []
								}
							]
						},
						"url": {
							"raw": "{{baseUrl}}/api/wos/{{woId}}/complete",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"wos",
								"{{woId}}",
								"complete"
							]
						},
						"description": "✅ ENHANCED - Complete job with photo upload\n\n**UI: Complete Job Modal**\n\n**Work Photos (Required):**\n• Tap to upload photos\n• Minimum: 1 photo required\n• Maximum: 5 photos (10MB each)\n• Formats: JPEG, PNG, PDF\n\n**Work Notes (Optional):**\n• Add notes about work completed\n• Parts used, recommendations\n• Any issues encountered\n\n**Commission Calculation:**\n```\nJob Payment: $120\nCommission Rate: 15%\nYou Earn: $18.00\nPayment processed after verification\n```\n\n**Form Fields:**\n• photos (required): File uploads (1-5 files)\n• completionNotes (optional): Work description\n• materialsUsed (optional): JSON array\n\n**Status Flow:**\nIN_PROGRESS → COMPLETED → Commission EARNED\n\n**What Happens:**\n1. Status changes to COMPLETED\n2. Photos uploaded to server\n3. Admin verifies payment\n4. Commission added to wallet (15%)\n5. Available for payout\n\n**Status:** ✅ DOCUMENTED"
					}
				}
			]
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:4000"
		},
		{
			"key": "techToken",
			"value": ""
		},
		{
			"key": "dispatcherToken",
			"value": ""
		},
		{
			"key": "woId",
			"value": ""
		}
	]
}
